function [deepnet]=deep_train(img,label)
%注意，这里的img和label必须是保证一列一个的
%为了能够计算，这里的label需要修改为one-hot编码格式
rng('default');
num_hid1 = 100;
% 因为是自编码器，也属于无监督学习算法，因此不需要目标值 train_y 的参与
ae1 = trainAutoencoder(img, num_hid1, ...
    'MaxEpochs', 400, ...
    'L2WeightRegularization', .004, ...
    'SparsityRegularization', 4, ...
    'SparsityProportion', 0.15, ...
    'ScaleData', false);
% 使用第一个自编码器得到其对应的压缩编码，
feat1 = encode(ae1, img);
num_hid2 = 50;
ae2 = trainAutoencoder(feat1, num_hid2, ...
        'MaxEpochs', 100, ...
        'L2WeightRegularization', .002, ...
        'SparsityRegularization', 4, ...
        'SparsityProportion', 0.1, ...
        'ScaleData', false);
%view(ae2);
% 使用第二个自编码器得到其对应的压缩编码
feat2 = encode(ae2, feat1);
softnet = trainSoftmaxLayer(feat2, label, 'MaxEpochs', 400);
deepnet = stack(ae1, ae2, softnet);
end